<html>
<head>
<title>DoorLock UI</title>


<link rel="stylesheet" type="text/css" href="semantic/semantic.min.css">

  <script src="js/jquery.js"></script>
<script src="semantic/semantic.min.js"></script>
  <style>
  body {
    padding: 1em;
  }
  form {
    padding-top: 3em;
  }
  
  h5 {
    padding-left: 1em;
  }
  .cardb {
    padding: 3px;
  }
  </style>


</head>
<body>
  <div class="ui text container">
    <div class="ui menu">
    <div class="header item">Door Admin</div>
    <a class="item " data-tab="log">Log</a>
    <a class="item" data-tab="cards">Cards</a>
    <a class="item" data-tab="admin">Admin</a>
  </div>
  <div class="ui bottom  tab" data-tab="log">
    <h1 class="ui dividing header">Access Log</h1>
    <div class="ui relaxed divided list accesslog">
      <!-- populated via json file -->
    </div>
  </div>
  <div class="ui bottom  tab " data-tab="cards">
    <h1 class="ui dividing header">Card List</h1>

          <table class="ui celled table compact">
      <thead>
        <tr>
          <th>Name</th>
          <th>Card</th>
          <th>Hours</th>
          <th>Last Used</th>
        </tr>
      </thead>
      <tbody class="idlist">
       <!-- populated via json file -->
      </tbody>
    </table>
  </div>
  <div class="ui bottom  tab  active active" data-tab="admin">
        <form class="ui form wifi">
        <h4 class="ui dividing header">Wifi Settings</h4>
        <div class="field">
            <div class="ui toggle checkbox">
              <input type="checkbox" name="apmode" tabindex="0">
              <label>Connect to existing Station</label>
            </div>
          </div>
             <div class="two fields">
             <div class="field">
              <label>Station Name</label>
              <input type="text" name="stationname" placeholder="DoorConfigWifi">
              </div>
              <div class="field">
             <label>Password</label>
              <input type="text" name="stationpass" placeholder="">
              </div>
            </div>
           
        </form>
        
        <form class="ui form accesscard">
        <h4 class="ui dividing header">Card Settings</h4>
        <div class="three fields">
          <div class="field">
            <div class="ui toggle checkbox">
              <input type="checkbox" name="ignoreparity" tabindex="0">
              <label>Ignore Parity</label>
            </div>
          </div>
          <div class="field">
            <div class="ui toggle checkbox">
              <input type="checkbox" name="ignoresitecode" tabindex="0">
              <label>Ignore Site Code</label>
            </div>
          </div>
          <div class="field">
            <div class="ui toggle checkbox">
              <input type="checkbox" name="logfailures" tabindex="0">
              <label>Log Failures</label>
            </div>
          </div>
          </div>
          
          

          <div class="ui raised segment compact" style="margin: 4em auto; padding:">
          <span id="par1" class="cardb">
            <a class="ui orange empty circular label"></a>
          </span>
          <span id="sitebits" class="cardb">
            <a class="ui red empty circular label"></a>
            <a class="ui red empty circular label"></a>
            <a class="ui red empty circular label"></a>
            <a class="ui red empty circular label"></a>
            <a class="ui red empty circular label"></a>
            <a class="ui red empty circular label"></a>
            <a class="ui red empty circular label"></a>
           </span>
           <span id="idbits" class="cardb">
            <a class="ui green empty circular label"></a>
            <a class="ui green empty circular label"></a>
            <a class="ui green empty circular label"></a>
            <a class="ui green empty circular label"></a>
            <a class="ui green empty circular label"></a>
            <a class="ui green empty circular label"></a>
            <a class="ui green empty circular label"></a>
            <a class="ui green empty circular label"></a>
            <a class="ui green empty circular label"></a>
            <a class="ui green empty circular label"></a>
            <a class="ui green empty circular label"></a>
            <a class="ui green empty circular label"></a>
            <a class="ui green empty circular label"></a>
            <a class="ui green empty circular label"></a>
            <a class="ui green empty circular label"></a>
            <a class="ui green empty circular label"></a>
            <a class="ui green empty circular label"></a>
            <a class="ui green empty circular label"></a>
            <a class="ui green empty circular label"></a>
            <a class="ui green empty circular label"></a>
            <a class="ui green empty circular label"></a>
            <a class="ui green empty circular label"></a>
            <a class="ui green empty circular label"></a>
            <a class="ui green empty circular label"></a>
            </span>
            <span id="par2" class="cardb">
            <a class="ui teal empty circular label"></a>
            </span>
            
            
            

          </div>
          
          <div class="four fields">
                  <div class="field">
             <label class="ui orange"><a class="ui red empty circular label"></a>Site Start Bit </label>
              <input type="text" name="sitestartbit" placeholder="1">
              </div>
                      <div class="field">
             <label><a class="ui red empty circular label"></a>Site Length </label>
              <input type="text" name="sitelength" placeholder="7">
              </div>
              
                          <div class="field">
             <label><a class="ui green empty circular label"></a>ID Start Bit </label>
              <input type="text" name="idstartbit" placeholder="9">
              </div>
                      <div class="field">
             <label><a class="ui green empty circular label"></a>ID Length </label>
              <input type="text" name="idlength" placeholder="24">
              </div>
          </div>
              <div class="four fields" id="par1fields">
                  <div class="field">
             <label><a class="ui orange empty circular label"></a>Parity Type </label>
              <select class="ui fluid search dropdown" name="parity1type">
                <option value="odd">Odd</option>
                <option value="none">None</option>
                <option value="even">Even</option>
              </select>
              </div>
                      <div class="field">
             <label><a class="ui orange empty circular label"></a>Parity Position </label>
              <input type="text" name="parity1pos" placeholder="0">
              </div>
              
                          <div class="field">
             <label><a class="ui orange empty circular label"></a>Bits to Sum </label>
              <input type="text" name="parity1bits" placeholder="7">
              </div>
                      <div class="field">
             <label><a class="ui orange empty circular label"></a>Start Bit </label>
              <input type="text" name="parity1start" placeholder="1">
              </div>
          </div>
          
              <div class="four fields" id="par2fields">
                  <div class="field">
             <label><a class="ui teal empty circular label"></a>Parity Type</label>
              <select class="ui fluid search dropdown" name="parity2type">
                <option value="even">Even</option>
                <option value="none">None</option>
                <option value="odd">Odd</option>
              </select>
              </div>
                      <div class="field">
             <label><a class="ui teal empty circular label"></a>Parity Position</label>
              <input type="text" name="parity2pos" placeholder="32">
              </div>
              
                          <div class="field">
             <label><a class="ui teal empty circular label"></a>Bits to Sum</label>
              <input type="text" name="parity2bits" placeholder="24">
              </div>
                      <div class="field">
             <label><a class="ui teal empty circular label"></a>Start Bit</label>
              <input type="text" name="parity2start" placeholder="9">
              </div>
          </div>
          

        </form>
        
        <form class="ui form dbupdate">
        <h4 class="ui dividing header">External Database Sync Settings</h4>
        
       <div class="two fields">
          <div class="field">
            <div class="ui toggle checkbox">
              <input type="checkbox" name="updatecards" tabindex="0">
              <label>Sync Cards</label>
            </div>
          </div>
          <div class="field">
            <div class="ui toggle checkbox">
              <input type="checkbox" name="pushlogs" tabindex="0">
              <label>Push Logs</label>
            </div>
          </div>
          </div>
              <div class="field">
             <label>Update URL</label>
              <input type="text" name="updateurl" placeholder="">
              </div>

            

             
              <div class="field">
             <label>Push URL</label>
              <input type="text" name="pushurl" placeholder="">
              </div>
      <div class="ui button" tabindex="0">Save Changes</div>
      <div class="ui button" tabindex="0">Sync Now</div>
        </form>
  </div>
    
  </div>
  
  
<script>
$('.menu .item')
  .tab()
;
</script>

<script>
$.getJSON( "access.json", function( data ) {
  var items = [];
  $.each( data, function( key, val ) {
  color='';
  badge='';
    if (val.access.result == "Granted"){ color='green'; badge='privacy'; }
    if (val.access.result == "Denied"){ color='red';  badge='remove'; }
    if (val.access.result == "Warning"){ color='orange';  badge='warning'; }
    if (val.access.message != undefined) message = "<div class='detail'>"+  val.access.message +"</div>";
    else message="";
    
    
    items.push( " <div class='item'><i class='large "+badge+" middle aligned icon'></i><div class='content'><div class='ui label'>ID<div class='detail'>"+val.id+"</div></div><div class='ui label'>Site<div class='detail'>"+val.site+"</div></div><a class='ui " + color +" image label'>Access "+ val.access.result +" "+message+"</a></div></div>" );
  });
 
 $(".accesslog").append(items.join(""));

});
</script>

<script>



$.getJSON( "cards.json", function( data ) {
  var items = [];
  $.each( data, function( key, val ) {
    var hours = [];
    
    $.each( val.hours, function( key, value ) {
      hours.push("<a class='ui yellow image label'>"+value.day+"<div class='detail'>"+value.range[0]+" to "+value.range[1]+"</div></a>");
    });
    
    items.push( "<tr class='id"+key+"'><td>"+val.name.first+" "+val.name.last+"</td> <td>"+val.card.site+":"+val.card.id+"</td><td>"+hours.join("")+"</td><td></td></tr>" );
    
  });
 
 $(".idlist").append(items.join(""));

});
</script>
<script>

$.getJSON( "admin.json", function( data ) {
  $.each($.find("select"), function (key,val){
    val.value = data[val.name];
    val.selected="selected";
  });
  $.each($.find("input"), function (key,val){
    val.value = data[val.name];
    if (val.type=="checkbox"){
      if (data[val.name]=="on" )val.checked=true;
      else val.checked=false;
    }
  });
});

function update(){
  var configs = {};
  $.each($.find("input"), function (key,val){
    if (val.type=="checkbox"){
      if (val.checked==true)configs[val.name]="on";
      if (val.checked==false)configs[val.name]="off";
    } else configs[val.name]=val.value;
  });
    $.each($.find("select"), function (key,val){
    configs[val.name]=val.value;
  });
  console.log(configs);
  
  $.ajax({
  type: "POST",
  url: "/admin.json",
  data: JSON.stringify(configs),
  success: console.log("Sucess"),
  error: console.log("Error")
});

}
</script>
</body>
</html>
